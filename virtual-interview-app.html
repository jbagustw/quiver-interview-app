<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Interview Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #6c757d;
        }

        button.danger {
            background: #dc3545;
        }

        button.success {
            background: #28a745;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        video {
            width: 100%;
            height: auto;
            display: block;
            background: #000;
        }

        .question-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .question-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .question-box p {
            color: #666;
            line-height: 1.6;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .timer {
            text-align: center;
            font-size: 2em;
            color: #667eea;
            margin: 20px 0;
            font-weight: bold;
        }

        .recordings-list {
            margin-top: 30px;
        }

        .recording-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .recording-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .recording-info h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .recording-info p {
            color: #666;
            font-size: 0.9em;
        }

        .recording-actions {
            display: flex;
            gap: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-badge.recording {
            background: #dc3545;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .status-badge.ready {
            background: #28a745;
            color: white;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #28a745;
        }

        @media (max-width: 640px) {
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎥 Virtual Interview Platform</h1>
            <p id="headerSubtitle">Sistem Wawancara Digital</p>
        </div>
        
        <div class="content">
            <!-- Login Screen -->
            <div id="loginScreen" class="screen active">
                <h2 style="margin-bottom: 30px; color: #333;">Masuk ke Sistem</h2>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="nama@email.com">
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password">
                </div>
                
                <div class="form-group">
                    <label for="userType">Tipe Pengguna</label>
                    <select id="userType" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px;">
                        <option value="candidate">Kandidat</option>
                        <option value="admin">Admin/HR</option>
                    </select>
                </div>
                
                <button onclick="login()" style="width: 100%;">Masuk</button>
                
                <p style="margin-top: 20px; color: #666; text-align: center;">
                    Demo: Gunakan email apapun dengan password "demo123"<br>
                    Untuk admin, gunakan email "admin@company.com"
                </p>
            </div>
            
            <!-- Interview Screen -->
            <div id="interviewScreen" class="screen">
                <div class="user-info">
                    <div>
                        <strong>Kandidat:</strong> <span id="candidateName"></span>
                    </div>
                    <button onclick="logout()" class="danger">Logout</button>
                </div>
                
                <div class="question-box">
                    <h3>Pertanyaan Interview</h3>
                    <p id="questionText">Ceritakan tentang diri Anda dan mengapa Anda tertarik dengan posisi ini?</p>
                </div>
                
                <div class="video-container">
                    <video id="videoPreview" autoplay muted></video>
                    <video id="videoPlayback" style="display: none;" controls></video>
                </div>
                
                <div class="timer" id="timer" style="display: none;">00:00</div>
                
                <div class="status-badge ready" id="statusBadge">Ready</div>
                
                <div class="controls">
                    <button id="startBtn" onclick="startRecording()">
                        🔴 Mulai Rekam
                    </button>
                    <button id="stopBtn" onclick="stopRecording()" disabled>
                        ⏹️ Stop Rekam
                    </button>
                    <button id="playBtn" onclick="playRecording()" disabled>
                        ▶️ Putar Hasil
                    </button>
                    <button id="saveBtn" onclick="saveRecording()" class="success" disabled>
                        💾 Simpan & Kirim
                    </button>
                    <button id="nextBtn" onclick="nextQuestion()" style="display: none;">
                        Pertanyaan Berikutnya ➡️
                    </button>
                </div>
            </div>
            
            <!-- Admin Dashboard -->
            <div id="adminScreen" class="screen">
                <div class="user-info">
                    <div>
                        <strong>Admin:</strong> <span id="adminName"></span>
                    </div>
                    <button onclick="logout()" class="danger">Logout</button>
                </div>
                
                <h2 style="margin-bottom: 30px; color: #333;">Dashboard Admin</h2>
                
                <div class="admin-stats">
                    <div class="stat-card">
                        <h3 id="totalRecordings">0</h3>
                        <p>Total Rekaman</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalCandidates">0</h3>
                        <p>Total Kandidat</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="todayRecordings">0</h3>
                        <p>Rekaman Hari Ini</p>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 20px; color: #333;">Daftar Rekaman Interview</h3>
                <div class="recordings-list" id="recordingsList">
                    <!-- Recordings will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let mediaRecorder;
        let recordedChunks = [];
        let stream;
        let currentUser = null;
        let timerInterval;
        let seconds = 0;
        let currentQuestionIndex = 0;
        
        // Questions Database
        const questions = [
            "Ceritakan tentang diri Anda dan mengapa Anda tertarik dengan posisi ini?",
            "Apa kekuatan terbesar Anda dan bagaimana itu akan membantu dalam pekerjaan ini?",
            "Bagaimana Anda mengatasi tekanan atau situasi stres dalam pekerjaan?",
            "Dimana Anda melihat diri Anda dalam 5 tahun ke depan?",
            "Apakah Anda memiliki pertanyaan untuk kami?"
        ];
        
        // In-memory storage for recordings
        let recordings = JSON.parse(localStorage.getItem('interviewRecordings') || '[]');
        
        // Initialize camera on load
        window.onload = async function() {
            // Check if there's a saved session
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                if (currentUser.type === 'admin') {
                    showAdminDashboard();
                } else {
                    showInterviewScreen();
                }
            }
        };
        
        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }, 
                    audio: true 
                });
                document.getElementById('videoPreview').srcObject = stream;
            } catch (err) {
                console.error('Error accessing camera:', err);
                alert('Tidak dapat mengakses kamera. Pastikan Anda memberikan izin akses.');
            }
        }
        
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const userType = document.getElementById('userType').value;
            
            if (!email || !password) {
                alert('Silakan isi email dan password');
                return;
            }
            
            // Simple demo authentication
            if (password !== 'demo123') {
                alert('Password salah! Gunakan "demo123" untuk demo');
                return;
            }
            
            currentUser = {
                email: email,
                name: email.split('@')[0],
                type: userType
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            if (userType === 'admin' && email === 'admin@company.com') {
                showAdminDashboard();
            } else if (userType === 'admin') {
                alert('Gunakan email admin@company.com untuk akses admin');
            } else {
                showInterviewScreen();
            }
        }
        
        async function showInterviewScreen() {
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('adminScreen').classList.remove('active');
            document.getElementById('interviewScreen').classList.add('active');
            document.getElementById('candidateName').textContent = currentUser.email;
            document.getElementById('headerSubtitle').textContent = 'Interview Session';
            
            await initCamera();
        }
        
        function showAdminDashboard() {
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('interviewScreen').classList.remove('active');
            document.getElementById('adminScreen').classList.add('active');
            document.getElementById('adminName').textContent = currentUser.email;
            document.getElementById('headerSubtitle').textContent = 'Admin Dashboard';
            
            updateAdminStats();
            loadRecordings();
        }
        
        function updateAdminStats() {
            const recordings = JSON.parse(localStorage.getItem('interviewRecordings') || '[]');
            const today = new Date().toDateString();
            const todayRecs = recordings.filter(r => new Date(r.date).toDateString() === today);
            const uniqueCandidates = [...new Set(recordings.map(r => r.candidate))];
            
            document.getElementById('totalRecordings').textContent = recordings.length;
            document.getElementById('totalCandidates').textContent = uniqueCandidates.length;
            document.getElementById('todayRecordings').textContent = todayRecs.length;
        }
        
        function loadRecordings() {
            const recordings = JSON.parse(localStorage.getItem('interviewRecordings') || '[]');
            const container = document.getElementById('recordingsList');
            
            if (recordings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Belum ada rekaman interview</p>';
                return;
            }
            
            container.innerHTML = recordings.map((rec, index) => `
                <div class="recording-item">
                    <div class="recording-info">
                        <h4>${rec.candidate}</h4>
                        <p>Pertanyaan: ${rec.question}</p>
                        <p>Tanggal: ${new Date(rec.date).toLocaleString('id-ID')}</p>
                        <p>Durasi: ${rec.duration}</p>
                    </div>
                    <div class="recording-actions">
                        <button onclick="downloadRecording(${index})" class="success">
                            📥 Download
                        </button>
                        <button onclick="deleteRecording(${index})" class="danger">
                            🗑️ Hapus
                        </button>
                    </div>
                </div>
            `).reverse().join('');
        }
        
        async function startRecording() {
            recordedChunks = [];
            
            const options = {
                mimeType: 'video/webm;codecs=vp9,opus'
            };
            
            if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                options.mimeType = 'video/webm';
            }
            
            try {
                mediaRecorder = new MediaRecorder(stream, options);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.start();
                
                // Update UI
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('playBtn').disabled = true;
                document.getElementById('saveBtn').disabled = true;
                document.getElementById('statusBadge').className = 'status-badge recording';
                document.getElementById('statusBadge').textContent = 'Recording...';
                
                // Start timer
                startTimer();
                
            } catch (err) {
                console.error('Error starting recording:', err);
                alert('Tidak dapat memulai perekaman');
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                
                // Stop timer
                stopTimer();
                
                // Update UI
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('playBtn').disabled = false;
                document.getElementById('saveBtn').disabled = false;
                document.getElementById('statusBadge').className = 'status-badge ready';
                document.getElementById('statusBadge').textContent = 'Recording Complete';
            }
        }
        
        function playRecording() {
            if (recordedChunks.length === 0) {
                alert('Tidak ada rekaman untuk diputar');
                return;
            }
            
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            
            const videoPreview = document.getElementById('videoPreview');
            const videoPlayback = document.getElementById('videoPlayback');
            
            videoPreview.style.display = 'none';
            videoPlayback.style.display = 'block';
            videoPlayback.src = url;
            videoPlayback.play();
        }
        
        function saveRecording() {
            if (recordedChunks.length === 0) {
                alert('Tidak ada rekaman untuk disimpan');
                return;
            }
            
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const reader = new FileReader();
            
            reader.onloadend = function() {
                const base64data = reader.result;
                
                const recording = {
                    candidate: currentUser.email,
                    question: questions[currentQuestionIndex],
                    date: new Date().toISOString(),
                    duration: formatTime(seconds),
                    data: base64data
                };
                
                // Save to localStorage
                let recordings = JSON.parse(localStorage.getItem('interviewRecordings') || '[]');
                recordings.push(recording);
                localStorage.setItem('interviewRecordings', JSON.stringify(recordings));
                
                alert('Rekaman berhasil disimpan!');
                
                // Reset for next question
                recordedChunks = [];
                seconds = 0;
                document.getElementById('timer').textContent = '00:00';
                document.getElementById('timer').style.display = 'none';
                document.getElementById('videoPreview').style.display = 'block';
                document.getElementById('videoPlayback').style.display = 'none';
                document.getElementById('saveBtn').disabled = true;
                document.getElementById('playBtn').disabled = true;
                
                // Show next question button
                if (currentQuestionIndex < questions.length - 1) {
                    document.getElementById('nextBtn').style.display = 'inline-block';
                } else {
                    alert('Terima kasih! Anda telah menyelesaikan semua pertanyaan interview.');
                    logout();
                }
            };
            
            reader.readAsDataURL(blob);
        }
        
        function nextQuestion() {
            currentQuestionIndex++;
            document.getElementById('questionText').textContent = questions[currentQuestionIndex];
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('statusBadge').className = 'status-badge ready';
            document.getElementById('statusBadge').textContent = 'Ready';
        }
        
        function downloadRecording(index) {
            const recordings = JSON.parse(localStorage.getItem('interviewRecordings') || '[]');
            const recording = recordings[index];
            
            // Convert base64 to blob
            const base64 = recording.data.split(',')[1];
            const byteCharacters = atob(base64);
            const byteNumbers = new Array(byteCharacters.length);
            
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: 'video/webm' });
            
            // Create download link
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `interview_${recording.candidate}_${new Date(recording.date).getTime()}.webm`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function deleteRecording(index) {
            if (confirm('Apakah Anda yakin ingin menghapus rekaman ini?')) {
                let recordings = JSON.parse(localStorage.getItem('interviewRecordings') || '[]');
                recordings.splice(index, 1);
                localStorage.setItem('interviewRecordings', JSON.stringify(recordings));
                updateAdminStats();
                loadRecordings();
            }
        }
        
        function startTimer() {
            document.getElementById('timer').style.display = 'block';
            timerInterval = setInterval(() => {
                seconds++;
                document.getElementById('timer').textContent = formatTime(seconds);
            }, 1000);
        }
        
        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const secs = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function logout() {
            // Stop camera if active
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // Clear session
            localStorage.removeItem('currentUser');
            currentUser = null;
            currentQuestionIndex = 0;
            
            // Reset UI
            document.getElementById('loginScreen').classList.add('active');
            document.getElementById('interviewScreen').classList.remove('active');
            document.getElementById('adminScreen').classList.remove('active');
            document.getElementById('headerSubtitle').textContent = 'Sistem Wawancara Digital';
            
            // Clear form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }
    </script>
</body>
</html>